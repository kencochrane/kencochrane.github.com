<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>KenCochrane.net</title>
	<meta name="description" content="">
	<meta name="author" content="Ken Cochrane">
        <link href="http://kencochrane.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="KenCochrane.net Atom Feed" />
            <link href="http://kencochrane.net/rss/all.rss" type="application/rss+xml" rel="alternate" title="KenCochrane.net RSS Feed" />
        	<link rel="icon" href="../../../../static/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="../../../../static/favicon.ico" type="image/x-icon"> 

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="../../../../theme/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="../../../../theme/bootstrap.min.css" rel="stylesheet">
	<link href="../../../../theme/local.css" rel="stylesheet">
	<link href="../../../../theme/css/font-awesome.css" rel="stylesheet">
	<link href="../../../../theme/pygments.css" rel="stylesheet">
	<style type="text/css">

      .sidebar-nav {
        padding: 9px 0;
      }
      .tag-1 {
        font-size: 13pt;
      }
      .tag-2 {
        font-size: 10pt;
      }
      .tag-2 {
        font-size: 8pt;
      }
      .tag-4 {
        font-size: 6pt;
     }
    </style>
	<script type="text/javascript">
	var disqus_identifier = "blog/2011/04/deploying-my-django-application-to-dotcloud/";
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = 'http://kencochrane.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
</head>
<body>
		<div class="topbar">
	  <div class="topbar-inner">
		<div class="container-fluid">
		  <a class="brand" href="../../../../index.html">KenCochrane.net</a>
			<ul class="nav">
																			<li><a href="../../../../about/index.html">About Me</a></li>
											<li><a href="../../../../projects/index.html">Projects</a></li>
																		<li class="active"><a href="../../../../category/blog.html">blog</a></li>
							</ul>
			<p class="pull-right"><a href="../../../../archives.html">[archives]</a> <a href="../../../../tags.html">[tags]</a></p>
		</div>
	  </div>
	</div>

	<div class="container-fluid">
	  <div class="sidebar">
		<div class="well">
		    						<div class="social">
			<h3>Social</h3>
			<ul>
								<li><a href="http://twitter.com/kencochrane">twitter</a></li>
								<li><a href="https://github.com/kencochrane">github</a></li>
												    <li><a href="http://kencochrane.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
				                                    <li><a href="http://kencochrane.net/rss/all.rss" type="application/rss+xml" rel="alternate">rss feed</a></li>
                			</ul>
			</div>
			
            <h4><i class="icon-tags icon-large"></i>Tags</h4>
            <ul>
                            <li class="tag-4">
                    <a href="../../../../tag/jobs.html">
                        <i class="icon-tag icon-large"></i>jobs
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/apphosted.html">
                        <i class="icon-tag icon-large"></i>apphosted
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/install.html">
                        <i class="icon-tag icon-large"></i>install
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/apache.html">
                        <i class="icon-tag icon-large"></i>apache
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/supervisor.html">
                        <i class="icon-tag icon-large"></i>supervisor
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/djangomaine.html">
                        <i class="icon-tag icon-large"></i>djangomaine
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/pci.html">
                        <i class="icon-tag icon-large"></i>pci
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/sentry.html">
                        <i class="icon-tag icon-large"></i>sentry
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/clickstream.html">
                        <i class="icon-tag icon-large"></i>clickstream
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/gunicorn.html">
                        <i class="icon-tag icon-large"></i>gunicorn
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/blog.html">
                        <i class="icon-tag icon-large"></i>blog
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/rhel5.html">
                        <i class="icon-tag icon-large"></i>rhel5
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/mysql.html">
                        <i class="icon-tag icon-large"></i>mysql
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/django-maine.html">
                        <i class="icon-tag icon-large"></i>django-maine
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/mercurial.html">
                        <i class="icon-tag icon-large"></i>Mercurial
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/gondor.html">
                        <i class="icon-tag icon-large"></i>gondor
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/recruiters.html">
                        <i class="icon-tag icon-large"></i>recruiters
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/fabric.html">
                        <i class="icon-tag icon-large"></i>fabric
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/upgrade.html">
                        <i class="icon-tag icon-large"></i>upgrade
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/job.html">
                        <i class="icon-tag icon-large"></i>job
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/djangozoom.html">
                        <i class="icon-tag icon-large"></i>djangozoom
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/openshift.html">
                        <i class="icon-tag icon-large"></i>openshift
                    </a>
                </li>
                            <li class="tag-1">
                    <a href="../../../../tag/python.html">
                        <i class="icon-tag icon-large"></i>python
                    </a>
                </li>
                            <li class="tag-2">
                    <a href="../../../../tag/heroku.html">
                        <i class="icon-tag icon-large"></i>heroku
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/startup.html">
                        <i class="icon-tag icon-large"></i>startup
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/newrelic.html">
                        <i class="icon-tag icon-large"></i>newrelic
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/supervisord.html">
                        <i class="icon-tag icon-large"></i>supervisord
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/work.html">
                        <i class="icon-tag icon-large"></i>work
                    </a>
                </li>
                            <li class="tag-2">
                    <a href="../../../../tag/dotcloud.html">
                        <i class="icon-tag icon-large"></i>dotcloud
                    </a>
                </li>
                            <li class="tag-2">
                    <a href="../../../../tag/centos5.html">
                        <i class="icon-tag icon-large"></i>centos5
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/percona.html">
                        <i class="icon-tag icon-large"></i>percona
                    </a>
                </li>
                            <li class="tag-2">
                    <a href="../../../../tag/djangocms.html">
                        <i class="icon-tag icon-large"></i>djangocms
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/stackato.html">
                        <i class="icon-tag icon-large"></i>stackato
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/pelican.html">
                        <i class="icon-tag icon-large"></i>pelican
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/nginx.html">
                        <i class="icon-tag icon-large"></i>nginx
                    </a>
                </li>
                            <li class="tag-1">
                    <a href="../../../../tag/hosting.html">
                        <i class="icon-tag icon-large"></i>hosting
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/epio.html">
                        <i class="icon-tag icon-large"></i>epio
                    </a>
                </li>
                            <li class="tag-1">
                    <a href="../../../../tag/django.html">
                        <i class="icon-tag icon-large"></i>django
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/rhel5.html">
                        <i class="icon-tag icon-large"></i>RHEL5
                    </a>
                </li>
                            <li class="tag-1">
                    <a href="../../../../tag/paas.html">
                        <i class="icon-tag icon-large"></i>paas
                    </a>
                </li>
                            <li class="tag-1">
                    <a href="../../../../tag/deployment.html">
                        <i class="icon-tag icon-large"></i>deployment
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/script.html">
                        <i class="icon-tag icon-large"></i>script
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/macosx.html">
                        <i class="icon-tag icon-large"></i>macosx
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/memcached.html">
                        <i class="icon-tag icon-large"></i>memcached
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/cashstar.html">
                        <i class="icon-tag icon-large"></i>cashstar
                    </a>
                </li>
                            <li class="tag-2">
                    <a href="../../../../tag/linux.html">
                        <i class="icon-tag icon-large"></i>linux
                    </a>
                </li>
                        </ul>
			
		</div>
	  </div>
	  <div class="content">
							<div class='article'>
		<div class="page-header"><h1>Deploying my Django application to dotCloud</h1></div>
		<div class="well small">Permalink: <a class="more" href="../../../../blog/2011/04/deploying-my-django-application-to-dotcloud/">2011-04-26 07:07:55</a>
by <a class="url fn" href="../../../../author/ken-cochrane.html">Ken Cochrane</a> in <a href="../../../../category/blog.html">blog</a>
tags: <a href="../../../../tag/django.html">django</a> <a href="../../../../tag/python.html">python</a> <a href="../../../../tag/deployment.html">deployment</a> <a href="../../../../tag/hosting.html">hosting</a> <a href="../../../../tag/dotcloud.html">dotcloud</a> <a href="../../../../tag/paas.html">paas</a> </div>
		<div><div class="warning">
<p class="first admonition-title">Warning</p>
<p>This post is out of date, please read the new updated one:</p>
<p class="last"><a class="reference external" href="http://kencochrane.net/blog/2012/03/deploying-a-django-application-on-dotcloud/">Deploying my Django application to dotCloud Part 2</a></p>
</div>
<p>I have recently wrote about <a class="reference external" href="http://kencochrane.net/blog/2011/04/my-experiences-with-epio/">ep.io</a> and <a class="reference external" href="http://kencochrane.net/blog/2011/04/my-day-gondorio/">gondor.io</a>, two new python/django hosting services that are currently in beta. Another new service that has just recently hit the scene and is causing a lot of waves is <a class="reference external" href="http://dotcloud.com">DotCloud.com</a>. DotCloud is a little different for a number of reasons. Their service isn't targeting any one technology stack like ep.io and gondor.io with Python/Django/wsgi.</p>
<p>DotCloud's goal is to provide a bunch of different independent services that you can use as building blocks to build your application. If you need a database, take your pick from one of the many they support. Need an application that uses Django or Rails on the front end, and Java in the backend, that is fine, you can do that too. They realize that most developers don't stick to one standard technology stack for all of their applications, so this allows you the flexibility to use the best tool for the job. It also gives you a nice playground to try out new services and see how they run without having to install, configure and maintain the service just for testing.</p>
<p>DotCloud was part of the Y Combinator summer class of 2010, and they just recently <a class="reference external" href="http://techcrunch.com/2011/03/22/paas-dotcloud-raises-10m-from-jerry-yang-benchmark-and-others/">raised $10 Million</a>. With access to that much money, I'm guessing they will be hiring a bunch of people pretty quickly, and I'm sure we will be seeing their services expand as well.</p>
<p>Like all new technologies, I want to play with them, and see if they live up to all of the hype. I was lucky enough to get a beta invite a few weeks ago, and I have been playing with it since. I decided that the best way to test it out would be to deploy my blog, and see how hard it would be. Here are the steps that I took to get my django based blog up and running on DotCloud. I ran into a few issues and I made sure that I put those in as well, so that if you get the same issue you can see how I solved it.</p>
<div class="section" id="documentation">
<h2>Documentation</h2>
<p>Before I get started with any new service the first thing I usually do is look at the documentation. DotCloud has a nice list of documents along with some tutorials on how to get started. These 3 documents were the ones that I used the most.</p>
<p><a class="reference external" href="http://docs.dotcloud.com/tutorials/django/">http://docs.dotcloud.com/tutorials/django/</a></p>
<p><a class="reference external" href="http://docs.dotcloud.com/components/mysql/">http://docs.dotcloud.com/components/mysql/</a></p>
<p><a class="reference external" href="http://docs.dotcloud.com/tutorials/firststeps/">http://docs.dotcloud.com/tutorials/firststeps/</a></p>
</div>
<div class="section" id="first-steps">
<h2>First Steps:</h2>
<p>Like all cool services these days, dotcloud uses a python based CLI, so before we can get started we need to install the dotcloud client and configure it so that we can start using it.</p>
<div class="highlight"><pre><span class="c"># create my dotcloud virtual environment.</span>
<span class="nv">$ </span>mkvirtualenv dotcloud

<span class="c"># install dotcloud client using pip</span>
<span class="nv">$ </span>pip install dotcloud

<span class="c"># create our application namespace called kencochrane</span>
<span class="nv">$ </span>dotcloud create kencochrane

<span class="c">#enter api key that we got from: http://www.dotcloud.com/account/settings when prompted</span>
<span class="c">#&lt;key goes here&gt;</span>
</pre></div>
<p>Now that we have the client all setup, and an application namespace, now we can start building our service. I have forked my blog repository on bitbucket so that I could make dotcloud specific changes to it and not effect my original repo.</p>
<div class="highlight"><pre><span class="c"># go into projects directory</span>
<span class="nb">cd</span> ~/projects

<span class="c"># forked kencochranenet to kencochranenet_dotcloud, now clone that. locally</span>
hg clone https://bitbucket.org/kencochrane/kencochranenet_dotcloud kencochrane_dotcloud

<span class="c"># go into the new directory.</span>
<span class="nb">cd </span>kencochrane_dotcloud
</pre></div>
<p>Reading through the documentation tells me that I need to create a wsgi.py file and put in the root of my project. Using <a class="reference external" href="http://docs.dotcloud.com/tutorials/django/#djangowsgipy">http://docs.dotcloud.com/tutorials/django/#djangowsgipy</a> as a template, I created my wsgi.py file below. I had issues with the default template and I needed to add a directory to the sys.path so that wsgi could find my django apps correctly. Here is my finished file.</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c"># Ken added this, only thing that is different from the example template (not counting settings file name)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span><span class="s">&#39;mysite&#39;</span><span class="p">)))</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;DJANGO_SETTINGS_MODULE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;mysite.settings&#39;</span>

<span class="kn">import</span> <span class="nn">django.core.handlers.wsgi</span>
<span class="n">djangoapplication</span> <span class="o">=</span> <span class="n">django</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">wsgi</span><span class="o">.</span><span class="n">WSGIHandler</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="k">if</span> <span class="s">&#39;SCRIPT_NAME&#39;</span> <span class="ow">in</span> <span class="n">environ</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">environ</span><span class="p">[</span><span class="s">&#39;SCRIPT_NAME&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">djangoapplication</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
</pre></div>
<p>DotCloud uses <a class="reference external" href="http://www.pip-installer.org/en/latest/#requirements-files">PIP requirements files</a> to manage your project dependencies. We already have our pip requirements file where it needs to be and named correctly so we don't need to do anything, but if we didn't have one, we would need to create one and put it in the root, and call it requirements.txt</p>
<p>DotCloud requires that we put all of our static media in a directory called 'static' in the root of our project.  Because my static media is already found elsewhere, I need to create a directory called static and move all of my files into it.</p>
<div class="highlight"><pre><span class="c"># we need to create a static directory to serve static media from (/static) .</span>
mkdir -p static
</pre></div>
<p>If you use the django admin then you will need to create a postinstall script that will create a symlink under static for your django admin media files. Here is what mine looks like. If you use this as a template, don't forget to change the DJANGO_SETTINGS_MODULE variable to match your project.</p>
<div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="c"># To import anything under django.*, we must set this variable.</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;DJANGO_SETTINGS_MODULE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;mysite.settings&#39;</span>
<span class="c"># Import the admin module. The media directory is right under it!</span>
<span class="kn">import</span> <span class="nn">django.contrib.admin</span>
<span class="c"># Retrieve the absolute path of the admin module.</span>
<span class="n">admindir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">django</span><span class="o">.</span><span class="n">contrib</span><span class="o">.</span><span class="n">admin</span><span class="o">.</span><span class="n">__file__</span><span class="p">)</span>
<span class="c"># Add /media behind it.</span>
<span class="n">mediadir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">admindir</span><span class="p">,</span> <span class="s">&#39;media&#39;</span><span class="p">)</span>
<span class="c"># Compute the path of the symlink under the static directory.</span>
<span class="n">staticlink</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;static&#39;</span><span class="p">,</span> <span class="s">&#39;admin_media&#39;</span><span class="p">)</span>
<span class="c"># If the link already exists, delete it.</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">staticlink</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">staticlink</span><span class="p">)</span>
<span class="c"># Install the correct link.</span>

<span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">mediadir</span><span class="p">,</span> <span class="n">staticlink</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span class="c"># make the script executable.</span>
chmod +x postinstall
</pre></div>
<p>Because we changed our location of our static media, we need to remember to update our settings.py file with the new settings. Here are my changes.</p>
<div class="highlight"><pre><span class="c"># edit settings.py file to the following.</span>
<span class="n">ADMIN_MEDIA_PREFIX</span> <span class="o">=</span> <span class="s">&#39;/static/admin_media/&#39;</span>

<span class="c"># change MEDIA_URL</span>
<span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="s">&#39;/static/&#39;</span>
</pre></div>
<p>Deployment</p>
<p>Now that we have our application's project structure all setup and configured the way dotcloud wants it, we can start up some services and then deploy our app. If you want to find out what services they have available, you can run the following command.</p>
<div class="highlight"><pre><span class="c"># find out which services that are available.</span>
dotcloud deploy -h

You can chose among the following services:
  java          host any Java servlet <span class="o">(</span>also Clojure, Play!, and much more<span class="o">)</span>
  mysql         the worlds most popular open <span class="nb">source </span>database
  nodejs        run JavaScript processes <span class="o">(</span>including web apps<span class="o">)</span>
  php           host any PHP web app: Drupal, WordPress...
  php-worker    run background PHP processes
  postgresql    the worlds most advanced open <span class="nb">source </span>database
  python        host any Python/WSGI web app: Django, Pylons, Web2py...
  python-worker run background Python processes
  rabbitmq      AMQP message queue server
  redis         advanced key-value store
  ruby          host any Ruby/Rack web app: Rails, Sinatra...
  ruby-worker   run background Ruby processes
  smtp          authenticated SMTP relay to send e-mails reliably
  static        host static HTTP content
</pre></div>
<p>We need a database for our blog, since it was originally setup to use mysql, lets use that one here. Start up a new mysql service called 'kencochrane.mysql'</p>
<div class="highlight"><pre><span class="c"># start up the database service.</span>
<span class="nv">$ </span>dotcloud deploy -t mysql kencochrane.mysql
Created <span class="s2">&quot;kencochrane.mysql&quot;</span>.
</pre></div>
<p>Let's make sure that it was created, and find out some more about our new database instance.</p>
<div class="highlight"><pre><span class="c"># get the information about our new service</span>
<span class="nv">$ </span>dotcloud info kencochrane.mysqlcluster: wolverine
config:
    mysql_password: password_was_changed
created_at: 1303671517.96066
name: kencochrane.mysql
namespace: kencochrane
ports:
-   name: ssh
    url: ssh://dotcloud@mysql.kencochrane.dotcloud.com:3912
-   name: mysql
    url: mysql://root:password_was_changed@mysql.kencochrane.dotcloud.com:3913
state: running
<span class="nb">type</span>: mysql
</pre></div>
<p>As you can see from above, we have a mysql database, it is running, and it lets us know the ssh and mysql urls and ports, along with the root password. Lets create our database. To do that we will login to the server and run some sql commands. (the sensitive information has been changed)</p>
<div class="highlight"><pre><span class="c"># connect to dotcloud mysql server instance</span>
<span class="nv">$ </span>dotcloud run kencochrane.mysql -- mysql -u root -p

<span class="c"># mysql -u root -p</span>
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or <span class="se">\g</span>.
Your MySQL connection id is 34
Server version: 5.1.41-3ubuntu12.10 <span class="o">(</span>Ubuntu<span class="o">)</span>

<span class="c"># create the user and database and give user permissions to database.</span>

Type <span class="s1">&#39;help;&#39;</span> or <span class="s1">&#39;\h&#39;</span> <span class="k">for </span>help. Type <span class="s1">&#39;\c&#39;</span> to clear the current input statement.

mysql&gt; create database blogdb;
Query OK, 1 row affected <span class="o">(</span>0.00 sec<span class="o">)</span>

mysql&gt; create user <span class="s1">&#39;blog_username&#39;</span> identified by <span class="s1">&#39;strong_password&#39;</span>;
Query OK, 0 rows affected <span class="o">(</span>0.05 sec<span class="o">)</span>

mysql&gt; grant all on blogdb.* to <span class="s1">&#39;blog_user&#39;</span>@<span class="s1">&#39;%&#39;</span>;
Query OK, 0 rows affected <span class="o">(</span>0.04 sec<span class="o">)</span>

mysql&gt; flush privileges;
Query OK, 0 rows affected <span class="o">(</span>0.00 sec<span class="o">)</span>

mysql&gt; <span class="nb">exit</span>;Bye
Shared connection to mysql.kencochrane.dotcloud.com closed.
</pre></div>
<p>Now that we have our database all setup, we need to change our settings file so that it has all of the new information. Here is what mine looks like.</p>
<div class="highlight"><pre><span class="c"># update your settings.py file.</span>

<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&#39;django.db.backends.mysql&#39;</span><span class="p">,</span>
        <span class="s">&#39;NAME&#39;</span><span class="p">:</span> <span class="s">&#39;blogdb&#39;</span><span class="p">,</span>
        <span class="s">&#39;USER&#39;</span><span class="p">:</span> <span class="s">&#39;blog_username&#39;</span><span class="p">,</span>
        <span class="s">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s">&#39;strong_password&#39;</span><span class="p">,</span>
        <span class="s">&#39;HOST&#39;</span><span class="p">:</span> <span class="s">&#39;mysql.kencochrane.dotcloud.com&#39;</span><span class="p">,</span>
        <span class="s">&#39;PORT&#39;</span><span class="p">:</span> <span class="s">&#39;3913&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>Now we are ready to deploy our Django app, but before I go any further it is important to know the following. Dotcloud will pay attention to your .hgignore files. If you have a settings file in your .hgignore file so that it doesn't get saved in the repo, it will not push those changes up to the cloud. You will need to remove it from the .hgignore in order to get those files out there. It is also import to remember that only changes that are committed are pushed, so don't forget to commit your changes. If you wanted to be tricky you could use a post install script to pull down the file from a secure location and install it that way, if you want to make things super secure.</p>
<p>Now that we have that behind us, lets get going. First we need to create a new python service.</p>
<div class="highlight"><pre><span class="c"># deploy a new python app called kencochrane.blog</span>
<span class="nv">$ </span>dotcloud deploy --type python kencochrane.blog
</pre></div>
<p>Service is now created so all we have to do is push our application to the new service.</p>
<div class="highlight"><pre><span class="c"># push out your changes to the server</span>
<span class="nv">$ </span>dotcloud push kencochrane.blog .
</pre></div>
<p>Now your code is out in the cloud, you just need to sync your database and run the migrations to get your database all setup, and you should be good to go.</p>
<div class="highlight"><pre><span class="c"># sync the database</span>
<span class="nv">$ </span>dotcloud run kencochrane.blog python current/mysite/manage.py syncdb

<span class="c"># we use south so run migrate</span>
<span class="nv">$ </span>dotcloud run kencochrane.blog python current/mysite/manage.py migrate
</pre></div>
<p>now it works, just go to <a class="reference external" href="http://blog.kencochrane.dotcloud.com/">http://blog.kencochrane.dotcloud.com/</a> to see.</p>
<p>If you need to look at the logs to see how it is going you can do it two ways. The first way will tail your logs for you to your console.</p>
<div class="highlight"><pre><span class="c"># look at logs of your service, it will tail them to your console. ctrl-c to stop.</span>
<span class="nv">$ </span>dotcloud logs kencochrane.blog
</pre></div>
<p>Or login via ssh and look at your logs.</p>
<div class="highlight"><pre><span class="c"># Open up a shell</span>
<span class="nv">$ </span>dotcloud ssh kencochrane.blog
</pre></div>
<p>Here are the ones you most likely care about.</p>
<div class="highlight"><pre><span class="c"># nginx access and error logs.</span>
/var/log/nginx/&lt;app_name&gt;.<span class="o">{</span>access,error<span class="o">}</span>.log

<span class="c"># wsgi error logs</span>
/var/log/supervisor/uswgi.log
</pre></div>
<p>If you need to restart your service just issue this command.</p>
<div class="highlight"><pre><span class="c"># restart the service</span>
dotcloud restart kencochrane.blog
</pre></div>
<p>DotCloud runs on Amazon's EC2 service, and last week while I was doing my testing, I was getting a bunch of errors, I wasn't sure if the errors were because this is a beta service, and they are still bugs in it, or if it was related to the amazon issues. Either way, I listed those errors below incase anyone else gets them. If I got the error I would just run the command again until it worked, sometimes it took 3 times before everything worked fine.</p>
<div class="highlight"><pre><span class="c"># attempt 1</span>
<span class="nv">$ </span>dotcloud push kencochrane.blog .DotCloud service unavailable <span class="o">(</span><span class="s2">&quot;No JSON object could be decoded&quot;</span><span class="o">)</span>.
Please try again later. If the problem persists, send an email to support@dotcloud.com.

<span class="c"># attempt 2</span>
<span class="nv">$ </span>dotcloud push kencochrane.blog .
<span class="c"># upload . ssh://dotcloud@uploader.dotcloud.com:1060/kencochrane.blog</span>
<span class="c"># hg</span>
remote: Warning: Permanently added <span class="s1">&#39;[uploader.dotcloud.com]:1060,[174.129.15.77]:1060&#39;</span> <span class="o">(</span>RSA<span class="o">)</span> to the list of known hosts.
pushing to ssh://dotcloud@uploader.dotcloud.com:1060/kencochrane.blog
searching <span class="k">for </span>changes
remote: adding changesets
remote: adding manifests
remote: adding file changes
remote: added 1 changesets with 3 changes to 3 files
Scheduling build
Fetching logs...
Build started...
mkdir: cannot create directory <span class="sb">`</span>126:afdea9036e83<span class="s1">&#39;: File exists</span>
<span class="s1">Failed to fetch tarball (&lt;type &#39;</span>exceptions.ValueError<span class="s1">&#39;&gt;: Failed to extract the tarball, abort.)</span>
<span class="s1">Build finished.</span>
<span class="s1">Shared connection to blog.kencochrane.dotcloud.com closed.</span>

<span class="s1"># 3rd time is a charm, it finally works.</span>
<span class="s1">$ dotcloud push kencochrane.blog .# upload . ssh://dotcloud@uploader.dotcloud.com:1060/kencochrane.blog</span>
<span class="s1"># hg</span>
<span class="s1">remote: Warning: Permanently added &#39;</span><span class="o">[</span>uploader.dotcloud.com<span class="o">]</span>:1060,<span class="o">[</span>174.129.15.77<span class="o">]</span>:1060<span class="err">&#39;</span> <span class="o">(</span>RSA<span class="o">)</span> to the list of known hosts.
pushing to ssh://dotcloud@uploader.dotcloud.com:1060/kencochrane.blog
searching <span class="k">for </span>changes
no changes found
Scheduling build
Fetching logs...
Build started...
.
. all of the files <span class="o">(</span>trimmed <span class="k">for </span>space<span class="o">)</span>
.
Fetched code revision 126:afdea9036e83
.
. all the requirments <span class="o">(</span>trimmed <span class="k">for </span>space<span class="o">)</span>
.
Cleaning up...
Reloading nginx configuration: nginx.
uwsgi: stopped
uwsgi: started
Build finished.

Shared connection to blog.kencochrane.dotcloud.com closed.
</pre></div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion:</h2>
<p>Setting up my blog on DotCloud was fairly straightforward, the documentation helped guide me along the way. I did run into a few road blocks that stopped me in my tracks for a little while, but after some digging I was able to get past those issues. Hopefully this post will help you overcome the same issues I had, and make your deployment a little more smooth.</p>
<p>The service is very flexible, which is going to be good for most developers, but with the added flexibility they added some complexity that doesn't exist on the other services. For example ep.io and gondor.io handle all database and user creation for you, so you don't need to know what commands to run to create the database and the user, and they also automatically add the database connection strings to your settings file. I for one don't mind the extra complexity considering I'm going to get the ability to have direct access to my database so that I can do what I want. Others, might not want to worry about that. If you are building an application for a client that isn't very tech savy, the more things that are automated the better.</p>
<p>DotCloud is still in beta, and if you take a look at their <a class="reference external" href="http://docs.dotcloud.com/components/roadmap/">roadmap</a>, they have very ambitious goals. I for one can't wait to see how they progress. I have only gone into a few of the many things that dotcloud has to offer, I recommend that you try it out for yourself and leave me a comment letting me know how you liked it.</p>
</div>
<div class="section" id="next-time">
<h2>Next time:</h2>
<p>I have been lucky enough to get a sneak peak at <a class="reference external" href="http://apphosted.com">http://apphosted.com</a> a python/django hosting service similar to gondor.io and ep.io. I'm currently playing with the service now, once I'm finished I'll post my findings.</p>
<div class="section" id="update">
<h3>Update:</h3>
<p>Read how this service stacks up against other services like it in my <a class="reference external" href="http://kencochrane.net/blog/2011/06/django-hosting-roundup-who-wins/">Django hosting roundup</a></p>
<p>2/16/2012: Full disclosure. On Feb 16th 2012, I <a class="reference external" href="http://kencochrane.net/blog/2012/03/im-now-working-for-dotcloud/">accepted a job with dotCloud</a>. I plan on keeping this blog post up to date and impartial. If you think there are any errors, please let me know in the comments.</p>
<div class="warning">
<p class="first admonition-title">Warning</p>
<p>This post is out of date, please read the new updated one:</p>
<p class="last"><a class="reference external" href="http://kencochrane.net/blog/2012/03/deploying-a-django-application-on-dotcloud/">Deploying my Django application to dotCloud Part 2</a></p>
</div>
</div>
</div>
</div>
		<div>
			<h2>Comments</h2>
		 	<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="KenCochrane">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
			<div id="disqus_thread"></div>					<div>
	</div>	
		<footer>
		  <p> Powered by <a href="http://getpelican.com">Pelican</a>, theme based on <a href="http://twitter.github.com/bootstrap/">Bootstrap, from Twitter</a>.</p>
		  <p>&copy; Ken Cochrane 2012</p>
		  <a title="Real Time Web Analytics" href="http://getclicky.com/66415850"><img alt="Real Time Web Analytics" src="//static.getclicky.com/media/links/badge.gif" border="0" /></a>
		</footer>
	  </div>

	</div>
<div class="container-fluid">
<script>var _gaq=[['_setAccount','UA-67696-11'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>

<script type="text/javascript">
var clicky_site_ids = clicky_site_ids || [];
clicky_site_ids.push(66415850);
(function() {
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = '//static.getclicky.com/js';
  ( document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0] ).appendChild( s );
})();
</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/66415850ns.gif" /></p></noscript>
</div>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>KenCochrane.net</title>
	<meta name="description" content="">
	<meta name="author" content="Ken Cochrane">
        <link href="http://kencochrane.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="KenCochrane.net Atom Feed" />
            <link href="http://kencochrane.net/rss/all.rss" type="application/rss+xml" rel="alternate" title="KenCochrane.net RSS Feed" />
        	<link rel="icon" href="../../../../static/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="../../../../static/favicon.ico" type="image/x-icon"> 

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="../../../../theme/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="../../../../theme/bootstrap.min.css" rel="stylesheet">
	<link href="../../../../theme/local.css" rel="stylesheet">
	<link href="../../../../theme/css/font-awesome.css" rel="stylesheet">
	<link href="../../../../theme/pygments.css" rel="stylesheet">
	<style type="text/css">

      .sidebar-nav {
        padding: 9px 0;
      }
      .tag-1 {
        font-size: 13pt;
      }
      .tag-2 {
        font-size: 10pt;
      }
      .tag-2 {
        font-size: 8pt;
      }
      .tag-4 {
        font-size: 6pt;
     }
    </style>
	<script type="text/javascript">
	var disqus_identifier = "blog/2010/05/Automated-Install-Script-for-memcached-on-RHEL5/";
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = 'http://kencochrane.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
</head>
<body>
		<div class="topbar">
	  <div class="topbar-inner">
		<div class="container-fluid">
		  <a class="brand" href="../../../../index.html">KenCochrane.net</a>
			<ul class="nav">
																			<li><a href="../../../../about/index.html">About Me</a></li>
											<li><a href="../../../../projects/index.html">Projects</a></li>
																		<li class="active"><a href="../../../../category/blog.html">blog</a></li>
							</ul>
			<p class="pull-right"><a href="../../../../archives.html">[archives]</a> <a href="../../../../tags.html">[tags]</a></p>
		</div>
	  </div>
	</div>

	<div class="container-fluid">
	  <div class="sidebar">
		<div class="well">
		    						<div class="social">
			<h3>Social</h3>
			<ul>
								<li><a href="http://twitter.com/kencochrane">twitter</a></li>
								<li><a href="https://github.com/kencochrane">github</a></li>
												    <li><a href="http://kencochrane.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
				                                    <li><a href="http://kencochrane.net/rss/all.rss" type="application/rss+xml" rel="alternate">rss feed</a></li>
                			</ul>
			</div>
			
            <h4><i class="icon-tags icon-large"></i>Tags</h4>
            <ul>
                            <li class="tag-4">
                    <a href="../../../../tag/jobs.html">
                        <i class="icon-tag icon-large"></i>jobs
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/apphosted.html">
                        <i class="icon-tag icon-large"></i>apphosted
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/install.html">
                        <i class="icon-tag icon-large"></i>install
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/apache.html">
                        <i class="icon-tag icon-large"></i>apache
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/supervisor.html">
                        <i class="icon-tag icon-large"></i>supervisor
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/djangomaine.html">
                        <i class="icon-tag icon-large"></i>djangomaine
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/pci.html">
                        <i class="icon-tag icon-large"></i>pci
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/sentry.html">
                        <i class="icon-tag icon-large"></i>sentry
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/clickstream.html">
                        <i class="icon-tag icon-large"></i>clickstream
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/gunicorn.html">
                        <i class="icon-tag icon-large"></i>gunicorn
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/blog.html">
                        <i class="icon-tag icon-large"></i>blog
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/rhel5.html">
                        <i class="icon-tag icon-large"></i>rhel5
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/mysql.html">
                        <i class="icon-tag icon-large"></i>mysql
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/django-maine.html">
                        <i class="icon-tag icon-large"></i>django-maine
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/mercurial.html">
                        <i class="icon-tag icon-large"></i>Mercurial
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/gondor.html">
                        <i class="icon-tag icon-large"></i>gondor
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/recruiters.html">
                        <i class="icon-tag icon-large"></i>recruiters
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/fabric.html">
                        <i class="icon-tag icon-large"></i>fabric
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/upgrade.html">
                        <i class="icon-tag icon-large"></i>upgrade
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/job.html">
                        <i class="icon-tag icon-large"></i>job
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/djangozoom.html">
                        <i class="icon-tag icon-large"></i>djangozoom
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/openshift.html">
                        <i class="icon-tag icon-large"></i>openshift
                    </a>
                </li>
                            <li class="tag-1">
                    <a href="../../../../tag/python.html">
                        <i class="icon-tag icon-large"></i>python
                    </a>
                </li>
                            <li class="tag-2">
                    <a href="../../../../tag/heroku.html">
                        <i class="icon-tag icon-large"></i>heroku
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/startup.html">
                        <i class="icon-tag icon-large"></i>startup
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/newrelic.html">
                        <i class="icon-tag icon-large"></i>newrelic
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/supervisord.html">
                        <i class="icon-tag icon-large"></i>supervisord
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/work.html">
                        <i class="icon-tag icon-large"></i>work
                    </a>
                </li>
                            <li class="tag-2">
                    <a href="../../../../tag/dotcloud.html">
                        <i class="icon-tag icon-large"></i>dotcloud
                    </a>
                </li>
                            <li class="tag-2">
                    <a href="../../../../tag/centos5.html">
                        <i class="icon-tag icon-large"></i>centos5
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/percona.html">
                        <i class="icon-tag icon-large"></i>percona
                    </a>
                </li>
                            <li class="tag-2">
                    <a href="../../../../tag/djangocms.html">
                        <i class="icon-tag icon-large"></i>djangocms
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/stackato.html">
                        <i class="icon-tag icon-large"></i>stackato
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/pelican.html">
                        <i class="icon-tag icon-large"></i>pelican
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/nginx.html">
                        <i class="icon-tag icon-large"></i>nginx
                    </a>
                </li>
                            <li class="tag-1">
                    <a href="../../../../tag/hosting.html">
                        <i class="icon-tag icon-large"></i>hosting
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/epio.html">
                        <i class="icon-tag icon-large"></i>epio
                    </a>
                </li>
                            <li class="tag-1">
                    <a href="../../../../tag/django.html">
                        <i class="icon-tag icon-large"></i>django
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/rhel5.html">
                        <i class="icon-tag icon-large"></i>RHEL5
                    </a>
                </li>
                            <li class="tag-1">
                    <a href="../../../../tag/paas.html">
                        <i class="icon-tag icon-large"></i>paas
                    </a>
                </li>
                            <li class="tag-1">
                    <a href="../../../../tag/deployment.html">
                        <i class="icon-tag icon-large"></i>deployment
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/script.html">
                        <i class="icon-tag icon-large"></i>script
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/macosx.html">
                        <i class="icon-tag icon-large"></i>macosx
                    </a>
                </li>
                            <li class="tag-4">
                    <a href="../../../../tag/memcached.html">
                        <i class="icon-tag icon-large"></i>memcached
                    </a>
                </li>
                            <li class="tag-3">
                    <a href="../../../../tag/cashstar.html">
                        <i class="icon-tag icon-large"></i>cashstar
                    </a>
                </li>
                            <li class="tag-2">
                    <a href="../../../../tag/linux.html">
                        <i class="icon-tag icon-large"></i>linux
                    </a>
                </li>
                        </ul>
			
		</div>
	  </div>
	  <div class="content">
							<div class='article'>
		<div class="page-header"><h1>Automated Install Script for memcached on RHEL5</h1></div>
		<div class="well small">Permalink: <a class="more" href="../../../../blog/2010/05/Automated-Install-Script-for-memcached-on-RHEL5/">2010-05-14 16:34:38</a>
by <a class="url fn" href="../../../../author/ken-cochrane.html">Ken Cochrane</a> in <a href="../../../../category/blog.html">blog</a>
tags: <a href="../../../../tag/linux.html">linux</a> <a href="../../../../tag/memcached.html">memcached</a> <a href="../../../../tag/rhel5.html">RHEL5</a> <a href="../../../../tag/install.html">install</a> <a href="../../../../tag/script.html">script</a> </div>
		<div><p>I created this script that will download memcached build,install and set it up to start up automatically on reboot. It also installs the init.d script to manage memcache so you can restart etc.</p>
<p>You can either copy and paste it into your shell prompt using a user that has install privileges (root,admin,etc) or you can copy into a .sh file and execute it.</p>
<p>The code for most of this was take from this blog post: <a class="reference external" href="http://www.vbseo.com/blogs/danny-bembibre/daemon-scripts-memcached-44/">http://www.vbseo.com/blogs/danny-bembibre/daemon-scripts-memcached-44/</a> it doesn't seem to be around anymore so I put it here for anyone else looking for this very helpful info.</p>
<div class="highlight"><pre>wget http://memcached.googlecode.com/files/memcached-1.4.5.tar.gz
tar -xvzf memcached-1.4.5.tar.gz
<span class="nb">cd </span>memcached-1.4.5
./configure
make
make <span class="nb">test</span>
make install

touch /etc/memcached.conf
cat <span class="s">&lt;&lt; EOF &gt;&gt; /etc/memcached.conf</span>
<span class="s">#Memory a user</span>
<span class="s">-m 64</span>
<span class="s"># default port</span>
<span class="s">-p 11211</span>
<span class="s"># user to run daemon nobody/apache/www-data</span>
<span class="s">-u nobody</span>
<span class="s"># only listen locally</span>
<span class="s">-l 127.0.0.1</span>
<span class="s">EOF</span>

touch /etc/init.d/memcached
chmod +x /etc/init.d/memcached

cat <span class="s">&lt;&lt; EOF &gt;&gt; /etc/init.d/memcached</span>
<span class="s">#!/bin/bash</span>
<span class="s">#</span>
<span class="s"># memcached    This shell script takes care of starting and stopping</span>
<span class="s">#              standalone memcached.</span>
<span class="s">#</span>
<span class="s"># chkconfig: - 80 12</span>
<span class="s"># description: memcached is a high-performance, distributed memory</span>
<span class="s">#              object caching system, generic in nature, but</span>
<span class="s">#              intended for use in speeding up dynamic web</span>
<span class="s">#              applications by alleviating database load.</span>
<span class="s"># processname: memcached</span>
<span class="s"># config: /etc/memcached.conf</span>
<span class="s"># Source function library.</span>
<span class="s">. /etc/rc.d/init.d/functions</span>
<span class="s">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span>
<span class="s">DAEMON=/usr/local/bin/memcached</span>
<span class="s">DAEMONBOOTSTRAP=/usr/local/bin/start-memcached</span>
<span class="s">DAEMONCONF=/etc/memcached.conf</span>
<span class="s">NAME=memcached</span>
<span class="s">DESC=memcached</span>
<span class="s">PIDFILE=/var/run/$NAME.pid</span>
<span class="s">[ -x $DAEMON ] || exit 0</span>
<span class="s">[ -x $DAEMONBOOTSTRAP ] || exit 0</span>
<span class="s">RETVAL=0</span>
<span class="s">start() {</span>
<span class="s"> echo -n $&quot;Starting $DESC: &quot;</span>
<span class="s"> daemon $DAEMONBOOTSTRAP $DAEMONCONF</span>
<span class="s"> RETVAL=$?</span>
<span class="s"> [ $RETVAL -eq 0 ] &amp;&amp; touch $PIDFILE</span>
<span class="s"> echo</span>
<span class="s"> return $RETVAL</span>
<span class="s">}</span>
<span class="s">stop() {</span>
<span class="s"> echo -n $&quot;Shutting down $DESC: &quot;</span>
<span class="s"> killproc $NAME</span>
<span class="s"> RETVAL=$?</span>
<span class="s"> echo</span>
<span class="s"> [ $RETVAL -eq 0 ] &amp;&amp; rm -f $PIDFILE</span>
<span class="s"> return $RETVAL</span>
<span class="s">}</span>
<span class="s"># See how we were called.</span>
<span class="s">case &quot;$1&quot; in</span>
<span class="s"> start)</span>
<span class="s">  start</span>
<span class="s">  ;;</span>
<span class="s"> stop)</span>
<span class="s">  stop</span>
<span class="s">  ;;</span>
<span class="s"> restart|reload)</span>
<span class="s">  stop</span>
<span class="s">  start</span>
<span class="s">  RETVAL=$?</span>
<span class="s">  ;;</span>
<span class="s"> status)</span>
<span class="s">  status $prog</span>
<span class="s">  RETVAL=$?</span>
<span class="s">  ;;</span>
<span class="s"> *)</span>
<span class="s">  echo $&quot;Usage: $0 {start|stop|restart|status}&quot;</span>
<span class="s">  exit 1</span>
<span class="s">esac</span>
<span class="s">exit $RETVAL</span>
<span class="s">EOF</span>

touch /usr/local/bin/start-memcached
chmod +x /usr/local/bin/start-memcached

cat <span class="s">&lt;&lt; EOF &gt;&gt; /usr/local/bin/start-memcached</span>
<span class="s">#!/usr/bin/perl -w</span>
<span class="s"># start-memcached</span>
<span class="s"># 2003/2004 - Jay Bonci &lt;jaybonci@debian.org&gt;</span>
<span class="s"># This script handles the parsing of the /etc/memcached.conf file</span>
<span class="s"># and was originally created for the Debian distribution.</span>
<span class="s"># Anyone may use this little script under the same terms as</span>
<span class="s"># memcached itself.</span>
<span class="s">use strict;</span>
<span class="s">if ($&gt; != 0 and $&lt; != 0) {</span>
<span class="s"> print STDERR &quot;Only root wants to run start-memcached.\n&quot;;</span>
<span class="s"> exit;</span>
<span class="s">}</span>
<span class="s">my $etcfile = shift || &quot;/etc/memcached.conf&quot;;</span>
<span class="s">my $params = [];</span>
<span class="s">my $etchandle;</span>
<span class="s"># This script assumes that memcached is located at /usr/bin/memcached, and</span>
<span class="s"># that the pidfile is writable at /var/run/memcached.pid</span>
<span class="s">my $memcached = &quot;/usr/local/bin/memcached&quot;;</span>
<span class="s">my $pidfile = &quot;/var/run/memcached.pid&quot;;</span>
<span class="s"># If we don&#39;t get a valid logfile parameter in the /etc/memcached.conf file,</span>
<span class="s"># we&#39;ll just throw away all of our in-daemon output. We need to re-tie it so</span>
<span class="s"># that non-bash shells will not hang on logout. Thanks to Michael Renner for</span>
<span class="s"># the tip</span>
<span class="s">my $fd_reopened = &quot;/dev/null&quot;;</span>
<span class="s">sub handle_logfile {</span>
<span class="s"> my ($logfile) = @_;</span>
<span class="s"> $fd_reopened = $logfile;</span>
<span class="s">}</span>
<span class="s">sub reopen_logfile {</span>
<span class="s"> my ($logfile) = @_;</span>
<span class="s"> open *STDERR, &quot;&gt;&gt;$logfile&quot;;</span>
<span class="s"> open *STDOUT, &quot;&gt;&gt;$logfile&quot;;</span>
<span class="s"> open *STDIN, &quot;&gt;&gt;/dev/null&quot;;</span>
<span class="s"> $fd_reopened = $logfile;</span>
<span class="s">}</span>
<span class="s"># This is set up in place here to support other non -[a-z] directives</span>
<span class="s">my $conf_directives = {</span>
<span class="s"> &quot;logfile&quot; =&gt; \&amp;handle_logfile</span>
<span class="s">};</span>
<span class="s">if (open $etchandle, $etcfile) {</span>
<span class="s"> foreach my $line (&lt;$etchandle&gt;) {</span>
<span class="s">  $line =~ s/\#.*//go;</span>
<span class="s">  $line = join &#39; &#39;, split &#39; &#39;, $line;</span>
<span class="s">  next unless $line;</span>
<span class="s">  next if $line =~ /^\-[dh]/o;</span>
<span class="s">  if ($line =~ /^[^\-]/o) {</span>
<span class="s">   my ($directive, $arg) = $line =~ /^(.*?)\s+(.*)/;</span>
<span class="s">   $conf_directives-&gt;{$directive}-&gt;($arg);</span>
<span class="s">   next;</span>
<span class="s">  }</span>
<span class="s">  push @$params, $line;</span>
<span class="s"> }</span>
<span class="s">}</span>
<span class="s">unshift @$params, &quot;-u root&quot; unless (grep $_ eq &#39;-u&#39;, @$params);</span>
<span class="s">$params = join &quot; &quot;, @$params;</span>
<span class="s">if (-e $pidfile) {</span>
<span class="s"> open PIDHANDLE, &quot;$pidfile&quot;;</span>
<span class="s"> my $localpid = &lt;PIDHANDLE&gt;;</span>
<span class="s"> close PIDHANDLE;</span>
<span class="s"> chomp $localpid;</span>
<span class="s"> if (-d &quot;/proc/$localpid&quot;) {</span>
<span class="s">  print STDERR &quot;memcached is already running.\n&quot;;</span>
<span class="s">  exit;</span>
<span class="s"> } else {</span>
<span class="s">  `rm -f $localpid`;</span>
<span class="s"> }</span>
<span class="s">}</span>
<span class="s">my $pid = fork();</span>
<span class="s">if ($pid == 0) {</span>
<span class="s"> reopen_logfile($fd_reopened);</span>
<span class="s"> exec &quot;$memcached $params&quot;;</span>
<span class="s"> exit(0);</span>
<span class="s">} elsif (open PIDHANDLE,&quot;&gt;$pidfile&quot;) {</span>
<span class="s"> print PIDHANDLE $pid;</span>
<span class="s"> close PIDHANDLE;</span>
<span class="s">} else {</span>
<span class="s"> print STDERR &quot;Can&#39;t write pidfile to $pidfile.\n&quot;;</span>
<span class="s">}</span>
<span class="s">EOF</span>

/etc/init.d/memcached restart
/sbin/chkconfig memcached on
</pre></div>
</div>
		<div>
			<h2>Comments</h2>
		 	<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="KenCochrane">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
			<div id="disqus_thread"></div>					<div>
	</div>	
		<footer>
		  <p> Powered by <a href="http://getpelican.com">Pelican</a>, theme based on <a href="http://twitter.github.com/bootstrap/">Bootstrap, from Twitter</a>.</p>
		  <p>&copy; Ken Cochrane 2012</p>
		  <a title="Real Time Web Analytics" href="http://getclicky.com/66415850"><img alt="Real Time Web Analytics" src="//static.getclicky.com/media/links/badge.gif" border="0" /></a>
		</footer>
	  </div>

	</div>
<div class="container-fluid">
<script>var _gaq=[['_setAccount','UA-67696-11'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>

<script type="text/javascript">
var clicky_site_ids = clicky_site_ids || [];
clicky_site_ids.push(66415850);
(function() {
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = '//static.getclicky.com/js';
  ( document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0] ).appendChild( s );
})();
</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/66415850ns.gif" /></p></noscript>
</div>
</body>
</html>